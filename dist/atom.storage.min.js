!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines")):"function"==typeof define&&define.amd?define(["exports","infestines"],t):t((e.atom=e.atom||{},e.atom.storage=e.atom.storage||{}),e.I)}(this,function(e,t){"use strict";function r(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var n=new WeakMap,a=function(e){var t=n.get(e);return t||n.set(e,t={}),t},o=function(e){try{return JSON.parse(e)}catch(e){return e}},i=function(e){return e&&e.constructor===Object&&"value"in e},s=function(e,r,n,a,s){var u=e.getItem(r);if(!u)return a;var c=o(u);return i(c)&&t.acyclicEqualsU(c.schema,n)&&!t.acyclicEqualsU(c.value,a)?(0<=s&&(c.expires=s+Date.now(),e.setItem(r,JSON.stringify(c))),c.value):(e.removeItem(r),a)},u=function(e){var t=e.storage,r=e.key;delete a(t)[r]},c=function(e){for(var t=e.storage,r=e.regex,n=e.unsafeDeleteAtoms,a=0;a<t.length;++a){var s=t.key(a);if(r.test(s)){var c=o(t.getItem(s));i(c)&&c.expires<=Date.now()&&(t.removeItem(s),n&&u({storage:t,key:s}))}}},f=function(e){var n=e.key,o=e.storage,i=r(e,["key","storage"]),u=i.value,c=i.Atom,f=i.time,l=i.schema,m=i.debounce,v=a(o),y=v[n];if(!y){v[n]=y=c(s(o,n,l,u,f));var p=y.changes();0<=m&&(p=p.debounce(m)),p.onValue(function(e){if(t.acyclicEqualsU(e,u))o.removeItem(n);else{var r={value:e};void 0!==l&&(r.schema=l),0<=f&&(r.expires=f+Date.now()),o.setItem(n,JSON.stringify(r))}})}return y};e.unsafeDeleteAtom=u,e.expireNow=c,e.default=f,Object.defineProperty(e,"__esModule",{value:!0})});
